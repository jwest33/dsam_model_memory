{% extends "base.html" %}
{% block content %}
<section class="chat">
  <div class="panel">
    <label>Session ID</label>
    <input id="session" value="default"/>
  </div>
  <div class="panel">
    <textarea id="input" placeholder="Say something..."></textarea>
    <button id="send">Send</button>
  </div>
  <pre id="reply"></pre>
</section>
<script>
const sendBtn = document.getElementById('send');
const input = document.getElementById('input');
const session = document.getElementById('session');
const replyEl = document.getElementById('reply');
let messages = [];

sendBtn.onclick = async () => {
  const text = input.value.trim();
  if(!text) return;
  const res = await fetch('/api/chat', {
    method: 'POST',
    headers: {'Content-Type':'application/json'},
    body: JSON.stringify({session_id: session.value, text, messages})
  });
  const data = await res.json();
  messages.push({role:'user', content:text});
  messages.push({role:'assistant', content:data.reply});
  replyEl.textContent = data.reply + "\n\n---\nBlock summary: " + JSON.stringify(data.block?.block || {}, null, 2);
  input.value = '';
};
</script>
{% endblock %}
